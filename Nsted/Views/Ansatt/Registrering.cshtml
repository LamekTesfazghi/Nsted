@model List<Nsted.Models.Registrering>
    @{
        ViewData["Title"] = "Registrering";
        var customerList = ViewBag.CustomerList as List<Nsted.Models.Kunde>;
    }

    <link rel="stylesheet" href="~/css/Registreringstyle.css" />

    <h1>Registrering</h1>

    <div class="container">
        <!-- Customer Selection Section -->
        <div class="row mb-3">
            <!-- Toggle Button -->
            <div class="col-12 mb-3 text-center">
                <button class="btn btn-outline-secondary" id="toggleButton" onclick="toggleCustomerForm()">Legg til ny kunde</button>
            </div>

            <!-- Existing Customer Dropdown -->
            <div class="col-md-6" id="existingCustomerSection">
                <label for="customerInput" class="form-label">Søk og velg en eksisterende kunde</label>
                <input class="form-control" list="customers" id="customerInput" placeholder="Skriv for å søke...">
                <datalist id="customers">
                    @foreach (var customer in customerList)
                    {
                        <option data-value="@customer.KundeId" value="@customer.Fornavn @customer.Etternavn"></option>
                    }
                </datalist>
            </div>

            <!-- New Customer Fields (Initially Hidden) -->
            <div id="newCustomerFields" style="display: none;">
                <!-- Kunde Informasjon -->
                <div class="row mb-3">
                    <div class="col-12">
                        <label class="form-label">Legg til ny kunde</label>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="text" class="form-control" name="kunde.Fornavn" placeholder="Fornavn">
                            <label for="fornavn">Fornavn</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="text" class="form-control" name="kunde.Etternavn" placeholder="Etternavn">
                            <label for="etternavn">Etternavn</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="text" class="form-control" name="kunde.Adresse" placeholder="Adresse">
                            <label for="adresse">Adresse</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="email" class="form-control" name="kunde.Email" placeholder="navn@eksempel.no">
                            <label for="email">Email addresse</label>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-floating">
                            <input type="number" class="form-control" name="kunde.Telefon" placeholder="Telefon">
                            <label for="telefonNummer">Telefon</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <form asp-controller="Ansatt" asp-action="HandleFormSubmission" method="post">
            <div class="row mb-3">
                <div class="col-md-6">
                    <!-- Første Rad -->
                    <label for="bookingTilUke" class="form-label">Booket Service Til Uke</label>
                    <input type="number" class="form-control" name="registrering.BookingTilUke" placeholder="Uke nr" aria-label="Booket Service Til Uke:" max="52" required>
                </div>
                <div class="col-md-6">
                    <!-- Første rad -->
                    <label for="henvendelseMottatt" class="form-label">Henvendelse mottatt og registrert</label>
                    <input type="date" class="form-control" name="registrering.HenvendelseMottatt" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <!-- Andre rad -->
                    <label for="caseFerdig" class="form-label">Case ferdig?</label>
                    <select class="form-select" name="registrering.CaseFerdig" required>
                        <option disabled selected>Velg et alternativ</option>
                        <option value="true">Ja</option>
                        <option value="false">Nei</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <!-- Andre rad -->
                    <label for="produktType" class="form-label">Produkt type</label>
                    <input type="text" class="form-control" name="registrering.ProduktType" placeholder="Produkttype" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-20">
                    <!-- Tredje rad -->
                    <label for="feilbeskrivelse" class="form-label">Bestilling / Feilbeskrivelse Fra Kunde</label>
                    <textarea class="form-control" name="registrering.Feilbeskrivelse" placeholder="Feilbeskrivelse" required></textarea>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <!-- Fjerde rad -->
                    <label for="avtaltLevering" class="form-label">Avtalt levering</label>
                    <input type="date" class="form-control" name="registrering.AvtaltLevering" required>
                </div>
                <div class="col-md-6">
                    <!-- Fjerde rad -->
                    <label for="produktMottatt" class="form-label">Produkt mottatt</label>
                    <input type="date" class="form-control" name="registrering.ProduktMottatt" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <!-- Femte rad -->
                    <label for="avtaltFerdigstillelseInnen" class="form-label">Avtalt ferdigstillelse innen</label>
                    <input type="date" class="form-control" name="registrering.AvtaltFerdigstillelseInnen" required>
                </div>
                <div class="col-md-6">
                    <!-- Femte rad -->
                    <label for="serviceFerdig" class="form-label">Service ferdig</label>
                    <input type="date" class="form-control" name="registrering.ServiceFerdig" required>
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-md-6">
                    <!-- Sjette rad -->
                    <label for="antallTimerUtført" class="form-label">Antall timer på utført service</label>
                    <input type="number" class="form-control" name="registrering.AntallTimerUtført" placeholder="Antall timer" required>
                </div>
                <div class="col-md-3">
                    <!-- Sjette rad -->
                    <label for="ordreNr" class="form-label">Ordrenr?</label>
                    <select class="form-select" name="registrering.OrdreNr" required>
                        <option disabled selected>Velg et alternativ</option>
                        <option value="true">Ja</option>
                        <option value="false">Nei</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <!-- Sjette rad -->
                    <label for="serviceSkjema" class="form-label">Service skjema?</label>
                    <select class="form-select" name="registrering.ServiceSkjema" required>
                        <option disabled selected>Velg et alternativ</option>
                        <option value="true">Ja</option>
                        <option value="false">Nei</option>
                    </select>
                </div>
            </div>

            <button type="submit" class="btn btn-primary">Send inn</button>
        </form>
    </div>


    <script>var isNewCustomerFormVisible = false;

        function toggleCustomerForm() {
            var newCustomerFields = document.getElementById('newCustomerFields');
            var existingCustomerSection = document.getElementById('existingCustomerSection');
            var toggleButton = document.getElementById('toggleButton');

            isNewCustomerFormVisible = !isNewCustomerFormVisible;

            if (isNewCustomerFormVisible) {
                newCustomerFields.style.display = 'block';
                existingCustomerSection.style.display = 'none';
                toggleButton.textContent = 'Velg eksisterende kunde';
            } else {
                newCustomerFields.style.display = 'none';
                existingCustomerSection.style.display = 'block';
                toggleButton.textContent = 'Legg til ny kunde';
            }
        }</script>